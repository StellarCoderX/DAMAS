<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Damas Arena</title>

  <!-- Fontes -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet" />

  <!-- √çcones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Estilos -->
  <link rel="stylesheet" href="css/style.css?v=20" />
  <link rel="stylesheet" href="css/game.css?v=20" />
  <link rel="stylesheet" href="css/tournament.css?v=20" />

  <!-- SDKs -->
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>

<body>
  <div id="main-container">

    <!-- =========================================
         1. TELA DE AUTENTICA√á√ÉO
         ========================================= -->
    <div id="auth-container">
      <div class="logo-area">
        <h1>DAMAS <span class="highlight">ARENA</span></h1>
        <p>Aposte, Jogue e Ven√ßa.</p>
      </div>

      <button id="tutorial-btn" class="tutorial-float">
        <i class="fa-solid fa-circle-info"></i> Como Funciona / Regras
      </button>

      <!-- Formul√°rio de Login -->
      <form id="login-form">
        <div class="input-group">
          <i class="fa-solid fa-envelope"></i>
          <input type="email" id="login-email" placeholder="Seu E-mail" required />
        </div>
        <div class="input-group">
          <i class="fa-solid fa-lock"></i>
          <input type="password" id="login-password" placeholder="Sua Senha" required />
        </div>
        <button type="submit" class="btn-primary">ENTRAR</button>
        <p class="switch-auth">
          Novo aqui? <a href="#" id="show-register">Crie sua conta</a>
        </p>
      </form>

      <!-- Formul√°rio de Cadastro -->
      <form id="register-form" style="display: none">
        <div class="input-group">
          <i class="fa-solid fa-envelope"></i>
          <input type="email" id="register-email" placeholder="E-mail" required />
        </div>
        <div class="input-group">
          <i class="fa-solid fa-lock"></i>
          <input type="password" id="register-password" placeholder="Senha" required />
        </div>
        <div class="input-group">
          <i class="fa-solid fa-ticket"></i>
          <input type="text" id="referral-code-input" placeholder="C√≥digo de Indica√ß√£o (Opcional)" />
        </div>
        <button type="submit" class="btn-primary">CADASTRAR</button>
        <p class="switch-auth">J√° tem conta? <a href="#" id="show-login">Fazer Login</a></p>
      </form>
      <p id="auth-message" class="message"></p>

      <div class="app-footer">
        <p>¬© 2025 - Desenvolvido por <strong>ALVINCODER</strong></p>
      </div>
    </div>

    <!-- =========================================
         2. TELA DO LOBBY
         ========================================= -->
    <div id="lobby-container" class="hidden">

      <!-- Cabe√ßalho do Perfil -->
      <div class="profile-header-card">
        <div class="profile-content">
          <div class="avatar-wrapper">
            <img id="lobby-avatar" src="https://ui-avatars.com/api/?name=User&background=random" alt="Avatar">
          </div>
          <div class="profile-info">
            <h2 id="lobby-welcome-message">Carregando...</h2>
            <button id="open-profile-btn"><i class="fa-solid fa-pen-to-square"></i> Editar Perfil</button>
          </div>
        </div>
      </div>

      <!-- Menu de A√ß√µes R√°pidas (RECUPERADO WHATSAPP) -->
      <div class="action-grid">
        <div class="action-card red-gradient" id="btn-toggle-create-room">
          <div class="icon-box"><i class="fa-solid fa-circle-plus"></i></div>
          <span>Criar Sala</span>
        </div>

        <button id="add-balance-btn" class="action-card green-gradient">
          <div class="icon-box"><i class="fa-brands fa-pix"></i></div>
          <span>Depositar</span>
        </button>

        <button id="withdraw-btn" class="action-card orange-gradient">
          <div class="icon-box"><i class="fa-solid fa-money-bill-transfer"></i></div>
          <span>Sacar</span>
        </button>

        <a href="https://chat.whatsapp.com/IhFRzg8Bt89JhacRTdySUN?mode=wwt" target="_blank" id="whatsapp-group-btn"
          class="action-card whatsapp-gradient">
          <div class="icon-box"><i class="fa-brands fa-whatsapp"></i></div>
          <span>Grupo VIP</span>
        </a>
      </div>

      <!-- Painel de Cria√ß√£o de Sala -->
      <div id="create-room-section" class="lobby-section hidden-animated hidden">
        <h3><i class="fa-solid fa-chess-board"></i> Configurar Partida</h3>
        <div class="config-grid">
          <div class="input-wrapper">
            <label>Aposta (R$)</label>
            <input type="number" id="bet-amount-input" placeholder="0.00" min="1" value="" />
          </div>
          <div class="input-wrapper">
            <label>Modo</label>
            <select id="game-mode-select">
              <option value="classic">Cl√°ssico 8x8</option>
              <option value="tablita">Tablita (Sorteio)</option>
              <option value="international">Internacional 10x10</option>
            </select>
          </div>
          <div class="input-wrapper">
            <label>Tempo</label>
            <select id="time-control-select">
              <option value="move">Por Jogada</option>
              <option value="match">Por Partida</option>
            </select>
          </div>
          <div id="timer-selection-container" class="input-wrapper" style="grid-column: span 3;">
            <label>Tempo por Jogada (Segundos)</label>
            <select id="timer-select"></select>
          </div>

          <!-- CHECKBOX SALA PRIVADA -->
          <div class="input-wrapper"
            style="grid-column: span 3; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 5px; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 8px;">
            <input type="checkbox" id="private-room-checkbox" style="width: 20px; height: 20px; cursor: pointer;">
            <label for="private-room-checkbox" style="margin: 0; cursor: pointer; color: #f1c40f; font-weight: bold;">üîí
              Sala Privada (Oculta)</label>
          </div>

        </div>
        <button id="create-room-btn" class="btn-confirm">INICIAR SALA</button>
        <p id="lobby-error-message"></p>
      </div>

      <!-- √Årea de Espera -->
      <div id="waiting-area" class="hidden">
        <div class="pulse-ring"></div>
        <p>Aguardando oponente...</p>
        <p class="room-code-label">C√ìDIGO: <strong id="room-code-display">---</strong></p>
        <p style="font-size: 0.8rem; color: #aaa; margin-top: 5px;">Envie este c√≥digo para seu amigo.</p>
        <div class="loader"></div>
        <button id="cancel-room-btn" class="btn-cancel">Cancelar</button>
      </div>

      <!-- SE√á√ÉO PARA ENTRAR COM C√ìDIGO -->
      <div class="lobby-section" style="margin-bottom: 20px;">
        <h3><i class="fa-solid fa-key"></i> Entrar em Sala Privada</h3>
        <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
          <input type="text" id="join-room-code-input" class="modern-input" placeholder="Digite o C√≥digo da Sala"
            style="text-transform: uppercase; margin: 0; font-weight: bold; text-align: center; letter-spacing: 2px;">
          <button id="join-private-btn" class="btn-confirm"
            style="width: auto; padding: 12px 20px; background: #3498db;"><i
              class="fa-solid fa-arrow-right"></i></button>
        </div>
      </div>

      <!-- CARD DE TORNEIO (ATUALIZADO) -->
      <div class="tournament-card">
        <div class="tournament-header">
          <span><i class="fa-solid fa-trophy"></i> Torneio Di√°rio</span>
          <span id="tournament-info-btn" class="info-icon-btn"><i class="fa-solid fa-circle-info"></i></span>
        </div>
        <div class="tournament-body">
          <h1 class="trn-title" style="color: #f1c40f; font-size: 1.5rem; font-weight: 800; margin-bottom: 5px;">
            TORNEIO 21:00</h1>

          <!-- TIMER INTEGRADO -->
          <div id="tournament-inline-timer" class="inline-countdown hidden">
            <span class="inline-label">INICIA EM:</span>
            <span id="countdown-timer-display">00:00:00</span>
          </div>

          <p style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 5px;">üë• M√≠nimo: <strong>4 Jogadores</strong></p>

          <div style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; margin: 10px 0;">
            <p style="color: #f1c40f; font-size: 0.85rem; font-weight: bold; margin-bottom: 5px;">üéÅ Premia√ß√£o (do
              Pote):</p>
            <div style="display: flex; justify-content: space-around; font-size: 0.8rem; color: #e2e8f0;">
              <span>ü•á 70%</span>
              <span>ü•à 30%</span>
            </div>
          </div>

          <div class="trn-stats">
            <p>Inscri√ß√£o: <strong>R$ 2,00</strong></p>
            <p id="trn-participants-count">Inscritos: 0</p>
            <p id="trn-prize-pool" style="color: #2ecc71; font-weight: bold;">Pr√™mio: R$ 0,00</p>
          </div>

          <div class="trn-actions">
            <button id="join-tournament-btn" class="gold-btn">Entrar no Torneio</button>
            <button id="leave-tournament-btn" class="red-btn hidden">Sair</button>
          </div>
        </div>
      </div>

      <!-- CARD DE AFILIADOS -->
      <div class="affiliate-card-modern" style="margin-bottom: 20px;">
        <div class="aff-header" onclick="toggleSection(this)"
          style="display: flex; justify-content: space-between; padding: 12px; cursor: pointer; background: rgba(0,0,0,0.2);">
          <span><i class="fa-solid fa-sack-dollar"></i> Indique e Ganhe</span>
          <i class="fa-solid fa-chevron-down"></i>
        </div>
        <div class="collapsible-body" style="display: none; padding: 15px;">
          <p style="margin-bottom: 15px; line-height: 1.4; color: #f8fafc;">
            Ganhe <strong>R$ 1,00</strong> de b√¥nus sempre que um amigo indicado fizer o primeiro dep√≥sito de <strong>R$
              5,00</strong> ou mais!
          </p>
          <div class="aff-buttons" style="display: flex; gap: 10px;">
            <button id="copy-referral-btn"
              style="flex: 1; padding: 8px; border-radius: 6px; background: rgba(255,255,255,0.1); border:none; color:white;"><i
                class="fa-solid fa-copy"></i> Copiar Link</button>
            <button id="view-referrals-btn"
              style="flex: 1; padding: 8px; border-radius: 6px; background: rgba(255,255,255,0.1); border:none; color:white;"><i
                class="fa-solid fa-users"></i> Indica√ß√µes</button>
          </div>
        </div>
      </div>

      <!-- Listas de Salas -->
      <div class="rooms-container">
        <button id="refresh-lobby-btn" class="btn-refresh"><i class="fa-solid fa-rotate-right"></i> Atualizar
          Salas</button>

        <div class="room-section">
          <h3><i class="fa-solid fa-gamepad"></i> Salas Abertas</h3>
          <div id="open-rooms-list" class="rooms-list">
            <p class="empty-list">Nenhuma sala dispon√≠vel.</p>
          </div>
        </div>

        <div class="room-section">
          <h3><i class="fa-solid fa-eye"></i> Partidas em Andamento</h3>
          <div id="active-rooms-list" class="rooms-list">
            <p class="empty-list">Nenhum jogo rolando.</p>
          </div>
        </div>
      </div>

      <div class="footer-lobby">
        <button id="view-history-btn" class="btn-text">Hist√≥rico</button>
        <button id="logout-btn" class="btn-text text-red">Sair</button>
      </div>

    </div> <!-- Fim Lobby -->

  </div> <!-- Fim Main Container -->

  <!-- =========================================
       4. MODAIS E OVERLAYS
       ========================================= -->

  <!-- Modal PIX -->
  <div id="pix-overlay" class="hidden modal-overlay">
    <div class="modal-card">
      <h3><i class="fa-brands fa-pix"></i> Dep√≥sito Autom√°tico</h3>
      <input type="number" id="deposit-amount" class="modern-input" placeholder="Valor (R$)" value="5.00">
      <button id="pay-mercadopago-btn" class="btn-confirm full-width">Gerar QR Code</button>
      <div id="mp-loading" class="hidden">
        <div class="spinner"></div>
      </div>
      <div id="qr-code-container" class="hidden">
        <p style="font-size:0.8em; color:#ccc;">Copie e pague no seu banco:</p>
        <img id="qr-code-img" src="" alt="QR"
          style="max-width:150px; margin:10px auto; display:block; border-radius:5px;">
        <textarea id="pix-copy-paste" readonly class="modern-textarea"></textarea>
        <button id="copy-pix-code-btn" class="btn-secondary">Copiar C√≥digo</button>
      </div>
      <button id="close-pix-overlay-btn" class="btn-close">Fechar</button>
    </div>
  </div>

  <!-- Modal Perfil -->
  <div id="profile-overlay" class="hidden modal-overlay">
    <div class="modal-card">
      <h3>Editar Perfil</h3>
      <div style="text-align:center; margin:10px 0;">
        <img id="profile-preview-img" src="" class="avatar-preview">
      </div>
      <input type="text" id="profile-username-input" class="modern-input" placeholder="Novo Nick">
      <input type="text" id="profile-avatar-input" class="modern-input" placeholder="URL da Imagem">
      <p id="profile-message"></p>
      <button id="save-profile-btn" class="btn-confirm full-width">Salvar</button>
      <button id="close-profile-btn" class="btn-close">Cancelar</button>
    </div>
  </div>

  <!-- Modal Retirada -->
  <div id="withdraw-overlay" class="hidden modal-overlay">
    <div class="modal-card">
      <h3>Solicitar Saque</h3>
      <p style="color:#e74c3c; font-size:0.8rem; margin-bottom:10px;">Taxa de 30% no saque.</p>
      <form id="withdraw-form">
        <input type="text" id="withdraw-pix-key" placeholder="Chave PIX" class="modern-input" required>
        <input type="number" id="withdraw-amount" placeholder="Valor (Min R$30)" min="30" class="modern-input" required>
        <button type="submit" class="btn-confirm full-width">Solicitar</button>
      </form>
      <p id="withdraw-message"></p>
      <button id="close-withdraw-overlay-btn" class="btn-close">Fechar</button>
    </div>
  </div>

  <!-- Modal Tutorial GERAL -->
  <div id="general-tutorial-overlay" class="hidden modal-overlay">
    <div class="modal-card" style="text-align:left; max-width: 600px;">
      <h3 style="text-align:center; color:#f1c40f; margin-bottom: 20px;">üìñ Como Funciona</h3>

      <div style="margin-bottom: 20px;">
        <h4 style="color: #2ecc71;">üéÆ 1. Partidas Valendo Dinheiro</h4>
        <p style="font-size: 0.9em; color: #ddd; margin-top: 5px;">
          Voc√™ pode criar ou entrar em salas de aposta. O vencedor leva o valor apostado pelo oponente (menos uma
          pequena taxa da banca, se houver).
          <br><strong>Modos:</strong> Cl√°ssico, Tablita (Sorteio de Abertura) e Internacional (10x10).
        </p>
      </div>

      <div style="margin-bottom: 20px;">
        <h4 style="color: #f39c12;">üèÜ 2. Torneio Di√°rio</h4>
        <p style="font-size: 0.9em; color: #ddd; margin-top: 5px;">
          Todos os dias √†s <strong>21:00</strong>. Inscri√ß√£o barata e pr√™mios divididos entre Campe√£o (50%) e Vice
          (30%). √â mata-mata: perdeu, saiu!
        </p>
      </div>

      <div style="margin-bottom: 20px;">
        <h4 style="color: #3498db;">üí∞ 3. Dep√≥sitos e Saques (PIX)</h4>
        <p style="font-size: 0.9em; color: #ddd; margin-top: 5px;">
          <strong>Dep√≥sito:</strong> Autom√°tico via PIX QR Code. O saldo cai na hora!<br>
          <strong>Saque:</strong> Solicite a retirada para sua chave PIX. M√≠nimo de R$ 30,00 (taxa de 30% aplicada no
          saque).
        </p>
      </div>

      <div style="margin-bottom: 20px;">
        <h4 style="color: #9b59b6;">üí∏ 4. Ganhe Indicando Amigos</h4>
        <p style="font-size: 0.9em; color: #ddd; margin-top: 5px;">
          Envie seu link de indica√ß√£o. Se seu amigo se cadastrar e fizer um primeiro dep√≥sito de pelo menos R$ 5,00,
          voc√™ ganha <strong>R$ 1,00</strong> de b√¥nus automaticamente!
        </p>
      </div>

      <hr style="border-color: rgba(255,255,255,0.1); margin: 20px 0;">

      <h3 style="text-align:center; color:#e85d40; margin-bottom: 15px;">üìú Regras Brasileiras</h3>
      <ul style="font-size:0.9rem; line-height:1.5; padding-left:20px; color:#ddd; list-style-type: disc;">
        <li>A captura √© Obrigat√≥ria.</li>
        <li>√â obrigado a capturar pela Lei da Maioria.</li>
        <li>Pode capturar para tr√°s.</li>
        <li>N√£o existe sopro.</li>
        <li>Pedra e Dama t√™m o mesmo valor para capturar e ser capturada.</li>
        <li>S√≥ de passar pela casa de coroa√ß√£o a pedra N√ÉO se transforma em Dama (precisa parar).</li>
        <li>√â permitido passar pela mesma casa mais de uma vez na captura.</li>
        <li>N√ÉO pode capturar a mesma Pe√ßa mais de uma vez.</li>
        <li>Primeiro efetua o movimento de captura, depois retira-se as pe√ßas.</li>
        <li>Vit√≥ria ao capturar todas as pe√ßas ou bloquear o oponente.</li>
      </ul>

      <div style="text-align:center; margin-top: 20px;">
        <button id="close-tutorial-btn" class="btn-close">Fechar Tutorial</button>
      </div>
    </div>
  </div>

  <!-- Outros Modais -->
  <div id="referrals-overlay" class="hidden modal-overlay">
    <div class="modal-card">
      <h3>Indica√ß√µes</h3>
      <div id="referrals-list"></div>
      <button id="close-referrals-overlay-btn" class="btn-close">Fechar</button>
    </div>
  </div>
  <div id="history-overlay" class="hidden modal-overlay">
    <div class="modal-card" style="max-width:500px;">
      <h3>Hist√≥rico</h3>
      <div id="history-list"></div>
      <div style="display:flex; gap:8px; justify-content:center; margin-top:12px;">
        <button id="close-history-overlay-btn" class="btn-close">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Modais de Jogo -->
  <div id="confirm-bet-overlay" class="hidden modal-overlay">
    <div class="modal-card">
      <h3>Confirmar Aposta</h3>
      <p>Valor: <strong id="confirm-bet-amount"></strong></p>
      <p id="confirm-game-mode"></p>
      <div class="confirm-buttons" style="margin-top:15px;">
        <button id="accept-bet-btn" class="btn-confirm">Aceitar</button>
        <button id="decline-bet-btn" class="btn-close">Recusar</button>
      </div>
    </div>
  </div>
  <div id="tournament-bracket-overlay" class="hidden modal-overlay">
    <div class="modal-card" style="max-width:95%;">
      <h3>Chaveamento</h3>
      <p id="tournament-round-display"></p>
      <div id="tournament-matches-list"></div>
      <button id="close-bracket-btn" class="btn-close">Fechar</button>
    </div>
  </div>


  <!-- MODAL INFO TORNEIO (ATUALIZADO) -->
  <div id="tournament-info-overlay" class="hidden modal-overlay">
    <div class="modal-card" style="max-width: 450px; text-align: left;">
      <h3
        style="color: #f1c40f; margin-bottom: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
        üèÜ Guia do Torneio</h3>

      <div
        style="text-align:left; line-height:1.6; color:#e0e0e0; font-size: 0.95rem; max-height: 70vh; overflow-y: auto; padding-right: 5px;">

        <div style="margin-bottom: 15px;">
          <h4 style="color: #3498db; margin-bottom: 5px;"><i class="fa-regular fa-clock"></i> Hor√°rio & Inscri√ß√£o</h4>
          <p style="margin-left: 10px;">‚Ä¢ <strong>In√≠cio:</strong> Todos os dias √†s <strong>21:00</strong> (Hor√°rio de
            Bras√≠lia).</p>
          <p style="margin-left: 10px;">‚Ä¢ <strong>Entrada:</strong> R$ 2,00 (Debitado do saldo).</p>
          <p style="margin-left: 10px;">‚Ä¢ <strong>Check-in:</strong> Esteja online no lobby 2 minutos antes.</p>
        </div>

        <div style="margin-bottom: 15px;">
          <h4 style="color: #2ecc71; margin-bottom: 5px;"><i class="fa-solid fa-sack-dollar"></i> Premia√ß√£o (Sem Taxas!)
          </h4>
          <p style="margin-left: 10px;">O valor total das inscri√ß√µes vai para o pote e √© dividido assim:</p>
          <ul style="margin-left: 25px; list-style-type: none; padding:0;">
            <li>ü•á <strong>Campe√£o:</strong> Leva 70% do pote.</li>
            <li>ü•à <strong>Vice-Campe√£o:</strong> Leva 30% do pote.</li>
          </ul>
        </div>

        <div style="margin-bottom: 15px;">
          <h4 style="color: #e74c3c; margin-bottom: 5px;"><i class="fa-solid fa-chess-board"></i> Regras da Partida</h4>
          <p style="margin-left: 10px;">‚Ä¢ <strong>Formato:</strong> Mata-mata (Elimina√ß√£o Simples).</p>
          <p style="margin-left: 10px;">‚Ä¢ <strong>Tempo:</strong> Jogo r√°pido! <strong>7 segundos</strong> por jogada.
          </p>
          <p style="margin-left: 10px;">‚Ä¢ <strong>M√≠nimo:</strong> 4 jogadores para o torneio acontecer.</p>
        </div>

        <div
          style="background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 6px; border-left: 3px solid #f1c40f;">
          <h4 style="color: #f1c40f; margin-bottom: 5px; font-size: 0.9rem;">ü§ù Crit√©rios de Desempate</h4>
          <p style="font-size: 0.85rem;">Se a partida terminar empatada:</p>
          <ol style="margin-left: 20px; font-size: 0.85rem; margin-bottom: 0;">
            <li><strong>Revanche Imediata:</strong> Nova partida no modo <strong>Tablita</strong>.</li>
            <li><strong>Tempo Reduzido:</strong> 5 segundos por jogada.</li>
            <li><strong>Morte S√∫bita:</strong> Repete-se at√© haver um vencedor.</li>
          </ol>
        </div>
      </div>

      <div style="text-align: center; margin-top: 15px;">
        <button id="close-tournament-info-btn" class="btn-close">Fechar</button>
      </div>
    </div>
  </div>

  <!-- √ÅUDIOS -->
  <audio id="join-sound" src="/sounds/join.mp3"></audio>

  <!-- Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="js/gameLogic.js?v=10"></script>
  <script src="js/ui-helpers.js?v=10"></script>
  <!-- Incluindo os arquivos separados -->
  <script src="js/lobby.js?v=10"></script>
  <script src="js/auth.js?v=10"></script>
  <!-- Novo Core do Jogo -->
  <script src="js/gameCore.js?v=10"></script>

  <script>
    // Fun√ß√£o para abrir/fechar se√ß√µes (como o card de afiliados)
    function toggleSection(element) {
      const body = element.nextElementSibling;
      element.classList.toggle('active');
      if (body.style.display === "block") body.style.display = "none";
      else body.style.display = "block";
    }
  </script>
  <script src="js/script.js?v=10"></script>
</body>

</html>