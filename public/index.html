<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Damas Aposta - Jogo Online</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="style.css" />
  <!-- SDK Mercado Pago -->
  <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>

<body>
  <div id="main-container">
    <div id="auth-container">
      <form id="login-form">
        <h2>LOGIN</h2>
        <input type="email" id="login-email" placeholder="Email" required />
        <input type="password" id="login-password" placeholder="Senha" required />
        <button type="submit">Entrar</button>
        <p>
          NÃ£o tem uma conta? <a href="#" id="show-register">Cadastre-se</a>
        </p>
      </form>
      <form id="register-form" style="display: none">
        <h2>Cadastro</h2>
        <input type="email" id="register-email" placeholder="Email" required />
        <input type="password" id="register-password" placeholder="Senha" required />
        <input type="text" id="referral-code-input" placeholder="CÃ³digo de IndicaÃ§Ã£o (Opcional)" />
        <button type="submit">Cadastrar</button>
        <p>JÃ¡ tem uma conta? <a href="#" id="show-login">FaÃ§a Login</a></p>
      </form>
      <p id="auth-message" class="message"></p>

      <div class="app-footer">
        <p>Â© 2025 - Desenvolvido por <strong>ALVINCODER</strong></p>
        <p>Contato: <a href="https://wa.me/5571920007957" target="_blank" class="whatsapp-link">+55 71 92000-7957</a>
        </p>
      </div>
    </div>

    <div id="rules-container">
      <h2>REGRAS BRASILEIRAS</h2>
      <ul>
        <li>A captura Ã© ObrigatÃ³ria.</li>
        <li>Ã‰ obrigado a capturar pela Lei da Maioria.</li>
        <li>Pode capturar para trÃ¡s.</li>
        <li>NÃ£o existe sopro.</li>
        <li>Pedra e Dama tem o mesmo valor para capturar e ser capturada.</li>
        <li>SÃ³ de passar pela casa de coraÃ§Ã£o a pedra NÃƒO se transforma em Dama.</li>
        <li>Ã‰ permitido passar pela mesma casa mais de uma vez na captura.</li>
        <li>NÃƒO pode capturar a mesma PeÃ§a mais de uma vez.</li>
        <li>Primeiro efetua o movimento de captura, depois retira-se as peÃ§as.</li>
        <li>O ganho acontece quando se captura todas as peÃ§as do adversÃ¡rio ou quando o seu oponente nÃ£o tem onde mexer.
        </li>
      </ul>
    </div>
  </div>

  <div id="lobby-container" class="hidden">
    <h2 id="lobby-welcome-message"></h2>

    <!-- ### SEÃ‡ÃƒO TORNEIO ### -->
    <div class="tournament-card">
      <div class="tournament-header">
        ğŸ† TORNEIO DIÃRIO (MATA-MATA) ğŸ†
      </div>
      <div class="tournament-body">
        <p>â° InÃ­cio: <strong>19:00</strong> (Todo dia)</p>
        <p>ğŸ’° InscriÃ§Ã£o: <strong>R$ 2,00</strong></p>
        <p>ğŸ‘¥ MÃ­nimo: 8 Jogadores</p>
        <hr style="border-color: rgba(255,255,255,0.1);">
        <p>ğŸ PrÃªmios (do Total Arrecadado):</p>
        <ul style="list-style: none; padding: 0; font-size: 0.9em; color: #f1c40f;">
          <li>ğŸ¥‡ CampeÃ£o: 50%</li>
          <li>ğŸ¥ˆ Vice: 30%</li>
          <li>ğŸ¦ Banca: 20%</li>
        </ul>

        <div id="tournament-status-area" style="margin-top: 15px;">
          <p id="trn-participants-count">Inscritos: 0</p>
          <p id="trn-prize-pool">PrÃªmio Atual: R$ 0,00</p>

          <div style="display: flex; gap: 10px; justify-content: center;">
            <button id="join-tournament-btn" class="gold-btn">Inscrever-se (R$ 2,00)</button>
            <!-- NOVO BOTÃƒO DE SAIR -->
            <button id="leave-tournament-btn" class="red-btn hidden"
              style="width: 100%; max-width: 250px; margin-top: 10px;">Remover InscriÃ§Ã£o</button>
          </div>

          <p id="trn-message" style="font-size: 0.8em; margin-top: 5px; min-height: 1.2em;"></p>
        </div>
      </div>
    </div>

    <div style="margin-bottom: 15px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;">
      <p style="font-size: 0.9em; margin-bottom: 5px;">ğŸ’¸ Ganhe R$ 1,00 se seu indicado depositar R$ 5,00!</p>
      <button id="copy-referral-btn"
        style="background-color: #9b59b6; font-size: 0.9em; padding: 8px; margin-bottom: 5px;">Copiar Link de
        IndicaÃ§Ã£o</button>
      <button id="view-referrals-btn" style="background-color: #8e44ad; font-size: 0.9em; padding: 8px;">Minhas
        IndicaÃ§Ãµes</button>
      <button id="view-history-btn"
        style="background-color: #34495e; font-size: 0.9em; padding: 8px; margin-top: 5px;">ğŸ“œ HistÃ³rico de
        Partidas</button>
    </div>

    <button id="add-balance-btn">Adicionar Saldo (AutomÃ¡tico)</button>

    <button id="withdraw-btn" style="background-color: #2ecc71;">Retirar Saldo</button>

    <a href="https://chat.whatsapp.com/IhFRzg8Bt89JhacRTdySUN?mode=wwt" id="whatsapp-group-btn" target="_blank">Entrar
      no Grupo do WhatsApp</a>
    <button id="logout-btn" style="background-color: #c0392b; margin-bottom: 20px">
      Sair
    </button>

    <div class="lobby-section" id="create-room-section">
      <h3>Criar uma nova partida</h3>
      <input type="number" id="bet-amount-input" placeholder="Valor da Aposta" min="1" value="1" />
      <div id="game-mode-selection" style="
            margin-top: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
          ">
        <label for="game-mode-select">Modo de Jogo:</label>
        <select id="game-mode-select" style="
              padding: 5px;
              border-radius: 4px;
              border: 1px solid #ccc;
              background-color: #f0f0f0;
            ">
          <option value="classic">ClÃ¡ssico 8x8</option>
          <option value="tablita">Tablita 8x8</option>
          <option value="international">Internacional 10x10</option>
        </select>
      </div>

      <div id="time-control-selection" style="
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
          ">
        <label for="time-control-select">Tipo de Tempo:</label>
        <select id="time-control-select" style="
              padding: 5px;
              border-radius: 4px;
              border: 1px solid #ccc;
              background-color: #f0f0f0;
            ">
          <option value="move">Por Jogada (PadrÃ£o)</option>
          <option value="match">Por Partida (Blitz)</option>
        </select>
      </div>

      <div id="timer-selection-container" style="
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
          ">
        <label for="timer-select">Tempo por Jogada:</label>
        <select id="timer-select" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc">
        </select>
      </div>

      <button id="create-room-btn">Criar Sala</button>
    </div>

    <div id="waiting-area" class="hidden">
      <p>A aguardar por um oponente...</p>
      <p>A sua sala estÃ¡ visÃ­vel para outros jogadores no lobby.</p>
      <button id="cancel-room-btn" style="background-color: #c0392b; margin-top: 10px">
        Cancelar
      </button>
      <strong id="room-code-display" style="display: none"></strong>
    </div>

    <div class="lobby-section" id="open-rooms-section">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h3>Salas Abertas</h3>
        <button id="refresh-lobby-btn"
          style="width: auto; padding: 5px 10px; font-size: 0.8em; background-color: #3498db;">Atualizar ğŸ”„</button>
      </div>
      <div id="open-rooms-list">
        <p>A carregar salas...</p>
      </div>
    </div>

    <div class="lobby-section" id="active-rooms-section" style="margin-top: 20px;">
      <h3>Jogos em Andamento (Assistir)</h3>
      <div id="active-rooms-list">
        <p>Nenhum jogo em andamento.</p>
      </div>
    </div>

    <p id="lobby-error-message" class="error-message"></p>

    <div class="app-footer">
      <p>Â© 2025 - Desenvolvido por <strong>ALVINCODER</strong></p>
      <p>Contato: <a href="https://wa.me/5571920007957" target="_blank" class="whatsapp-link">+55 71 92000-7957</a></p>
    </div>
  </div>

  <div id="game-container" class="hidden">
    <div id="spectator-indicator" class="hidden"
      style="background-color: #f39c12; color: #fff; padding: 5px 10px; border-radius: 5px; margin-bottom: 10px; font-weight: bold;">
      ğŸ‘€ MODO ESPECTADOR
    </div>

    <div id="tournament-indicator" class="hidden"
      style="background-color: #9b59b6; color: #fff; padding: 5px 10px; border-radius: 5px; margin-bottom: 10px; font-weight: bold;">
      ğŸ† PARTIDA DE TORNEIO
    </div>

    <div id="players-hud" class="players-hud hidden">
      <div class="player-badge white-player">
        <div class="piece-icon white-piece-icon"></div>
        <span id="white-player-name">Jogador 1</span>
      </div>
      <div class="vs-badge">VS</div>
      <div class="player-badge black-player">
        <div class="piece-icon black-piece-icon"></div>
        <span id="black-player-name">Jogador 2</span>
      </div>
    </div>

    <p id="game-status"></p>
    <div id="board"></div>
    <div id="game-info">
      <p>Vez de: <span id="turn">Brancas</span></p>
      <p>Tempo restante: <span id="timer">40</span>s</p>
      <div id="game-buttons">
        <button id="resign-btn">Desistir</button>
        <button id="draw-btn">Empate</button>
        <button id="spectator-leave-btn" class="hidden" style="background-color: #c0392b;">Sair do Jogo</button>
      </div>
    </div>
  </div>

  <!-- MODAL DE TORNEIO (MATA-MATA) -->
  <div id="tournament-bracket-overlay" class="hidden">
    <div class="modal-box" style="max-width: 95%; max-height: 90vh; overflow-y: auto;">
      <h3>ğŸ† Chaveamento do Torneio</h3>
      <p id="tournament-round-display">Oitavas de Final</p>
      <div id="tournament-matches-list" style="margin: 20px 0; display: flex; flex-direction: column; gap: 10px;">
        <!-- Preenchido via JS -->
      </div>
      <p id="tournament-wait-message" style="color: #f1c40f;">Aguardando inÃ­cio das partidas...</p>
      <button id="close-bracket-btn" style="background-color: #e74c3c;">Fechar</button>
    </div>
  </div>

  <div id="game-over-overlay" class="hidden">
    <div id="winner-screen" class="hidden">
      <div class="firework"></div>
      <div class="firework"></div>
      <div class="firework"></div>
      <h1>ParabÃ©ns, VocÃª Ganhou!</h1>
      <p class="revanche-status"></p>
      <div class="confirm-buttons">
        <button class="revanche-btn">Revanche</button>
        <button class="exit-lobby-btn">Voltar Ã  Tela Principal</button>
      </div>
    </div>
    <div id="loser-screen" class="hidden">
      <div class="emoji">ğŸ˜¢</div>
      <h1>VocÃª Perdeu</h1>
      <p class="revanche-status"></p>
      <div class="confirm-buttons">
        <button class="revanche-btn">Revanche</button>
        <button class="exit-lobby-btn">Voltar Ã  Tela Principal</button>
      </div>
    </div>
    <div id="draw-screen" class="hidden">
      <h1>Empate!</h1>
      <p id="draw-reason"></p>
      <p class="revanche-status"></p>
      <div class="confirm-buttons">
        <button class="revanche-btn">Revanche</button>
        <button class="exit-lobby-btn">Voltar Ã  Tela Principal</button>
      </div>
    </div>
    <div id="spectator-end-screen" class="hidden"
      style="background-color: #2c3e50; color: white; padding: 40px; border-radius: 15px; text-align: center; border: 5px solid #3498db;">
      <h1>Fim de Jogo</h1>
      <p id="spectator-end-message"></p>
      <div class="confirm-buttons">
        <button class="exit-lobby-btn" style="background-color: #3498db;">Voltar ao Lobby</button>
      </div>
    </div>
  </div>

  <div id="confirm-bet-overlay" class="hidden">
    <div id="confirm-bet-box">
      <h3>Confirmar Aposta</h3>
      <p>
        A aposta para esta sala Ã© de
        <strong id="confirm-bet-amount"></strong> crÃ©ditos.
      </p>
      <p id="confirm-game-mode" style="font-weight: bold; margin-top: 10px"></p>
      <p>VocÃª aceita?</p>
      <div class="confirm-buttons">
        <button id="accept-bet-btn">Aceitar</button>
        <button id="decline-bet-btn">Recusar</button>
      </div>
    </div>
  </div>
  <div id="connection-lost-overlay" class="hidden">
    <div id="connection-lost-box">
      <h3>ConexÃ£o InstÃ¡vel</h3>
      <p id="connection-lost-message"></p>
      <div class="loader"></div>
    </div>
  </div>
  <div id="next-game-overlay" class="hidden">
    <div id="next-game-box">
      <h2 id="next-game-title">Fim da 1Âª Partida!</h2>
      <p id="match-score-display" style="font-size: 1.2em; margin: 15px 0"></p>
      <p>A 2Âª partida comeÃ§arÃ¡ com as cores invertidas...</p>
      <p style="margin-top: 15px">
        A iniciar em <span id="next-game-timer">10</span>s
      </p>
    </div>
  </div>

  <div id="draw-request-overlay" class="hidden">
    <div id="draw-request-box">
      <h3>Pedido de Empate</h3>
      <p>O seu oponente propÃ´s um empate. VocÃª aceita?</p>
      <div class="confirm-buttons">
        <button id="accept-draw-btn">Aceitar</button>
        <button id="decline-draw-btn">Recusar</button>
      </div>
    </div>
  </div>

  <!-- ### ALTERADO: Modal de DepÃ³sito com Mercado Pago ### -->
  <div id="pix-overlay" class="hidden">
    <div class="modal-box">
      <h3>Recarga AutomÃ¡tica (PIX)</h3>
      <p>O saldo cai na hora!</p>

      <div style="margin: 20px 0;">
        <label for="deposit-amount" style="display: block; margin-bottom: 5px; color: #ccc;">Valor (R$):</label>
        <input type="number" id="deposit-amount" class="modal-input" placeholder="Ex: 10.00" min="1" step="0.01"
          value="5.00">
      </div>

      <button id="pay-mercadopago-btn" style="background-color: #009ee3; font-weight: bold; margin-bottom: 15px;">
        Pagar com PIX (Mercado Pago)
      </button>

      <div id="mp-loading" class="hidden" style="margin-bottom: 10px;">
        <div class="loader" style="width: 20px; height: 20px; border-width: 2px;"></div>
        <p style="font-size: 0.8em;">Gerando pagamento...</p>
      </div>

      <p class="instructions" style="font-size: 0.8em; color: #aaa; margin-top: 10px;">
        VocÃª serÃ¡ redirecionado para o pagamento seguro. ApÃ³s pagar, o saldo serÃ¡ adicionado automaticamente.
      </p>

      <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 15px 0;">

      <p style="font-size: 0.8em;">Problemas? Envie o comprovante:</p>
      <a href="#" id="send-proof-btn" target="_blank" class="whatsapp-link">Falar no WhatsApp</a>

      <button id="close-pix-overlay-btn">Fechar</button>
    </div>
  </div>

  <div id="withdraw-overlay" class="hidden">
    <div class="modal-box">
      <h3>Solicitar Retirada</h3>
      <p>Preencha os dados para receber seu saldo via PIX.</p>
      <p style="color: #f39c12; font-size: 0.9em; margin-bottom: 5px;">âš ï¸ O valor mÃ­nimo para retirada Ã© de <strong>R$
          30,00</strong>.</p>
      <!-- AVISO DE TAXA ADICIONADO -->
      <p style="color: #e74c3c; font-size: 0.9em; margin-bottom: 10px;">âš ï¸ Taxa de saque: <strong>30%</strong> do valor
        solicitado serÃ¡ descontado.</p>

      <form id="withdraw-form" style="display: flex; flex-direction: column; gap: 10px;">
        <input type="text" id="withdraw-pix-key" placeholder="Sua Chave PIX" required class="modal-input">
        <input type="number" id="withdraw-amount" placeholder="Valor (R$)" min="30" required class="modal-input">
        <button type="submit" style="background-color: #2ecc71; margin-top: 10px;">Solicitar</button>
      </form>

      <p id="withdraw-message" style="margin-top: 10px; font-weight: bold;"></p>
      <button id="close-withdraw-overlay-btn">Fechar</button>
    </div>
  </div>

  <div id="referrals-overlay" class="hidden">
    <div class="modal-box">
      <h3>Minhas IndicaÃ§Ãµes</h3>
      <p>Pessoas que se cadastraram com seu link.</p>

      <div id="referrals-list"
        style="margin-top: 15px; max-height: 200px; overflow-y: auto; text-align: left; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 5px;">
        <p>Carregando...</p>
      </div>

      <button id="close-referrals-overlay-btn">Fechar</button>
    </div>
  </div>

  <div id="history-overlay" class="hidden">
    <div class="modal-box" style="max-width: 600px;">
      <h3>HistÃ³rico de Partidas</h3>
      <div id="history-list"
        style="margin-top: 15px; max-height: 400px; overflow-y: auto; text-align: left; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 5px;">
        <p>Carregando...</p>
      </div>
      <button id="close-history-overlay-btn">Fechar</button>
    </div>
  </div>

  <audio id="move-sound" src="/sounds/move.mp3" preload="auto"></audio>
  <audio id="capture-sound" src="/sounds/capture.mp3" preload="auto"></audio>
  <!-- NOVO: Som de entrada na sala (usando move.mp3 como padrÃ£o, altere para join.mp3 se tiver o ficheiro) -->
  <audio id="join-sound" src="/sounds/move.mp3" preload="auto"></audio>

  <script src="/socket.io/socket.io.js"></script>

  <script src="gameLogic.js"></script>
  <script src="ui-helpers.js"></script>
  <script src="script.js"></script>
</body>

</html>